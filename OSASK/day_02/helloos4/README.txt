然后我们来改造asm.bat,将输出的文件名改成ipl.bin。另外,也顺便输出列表文件ipl.lst。这是一个文本文件,可以用来简单地确认每个指令是怎样翻译成机器语言的。到目前为止我们都没有输出过这个文件,那是因为1440KB的列表文件实在太大了,而这次只需要输出512字节,所以没什么问题。

另外我们还增加了一个makeimg.bat,它是以ipl.bin为基础,制作磁盘映像文件helloos. img的批处理文件。它利用笔者自己开发的磁盘映像管理工具edimg.exe,先读入一个空白的磁盘映像文件,然后在开头写入ipl.bin的内容,最后将结果输出为名为helloos.imng的磁盘映像文件。详情请参考makeimg.bat的内容。

这样,从编译到测试的步骤就变得非常简单了,我们只要双击!cons,然后在命令行窗口中按顺序输入asm->makeimg->run这3个命令就完成了。